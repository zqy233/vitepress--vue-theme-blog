import { _ as _export_sfc, c as createElementBlock, o as openBlock, a as createStaticVNode } from "./app.864f9b59.js";
const __pageData = JSON.parse('{"title":"\u5728Koa\u4E2D\u4F7F\u7528Redis","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u5B89\u88C5","slug":"\u5B89\u88C5"},{"level":2,"title":"\u6570\u636E\u64CD\u4F5C","slug":"\u6570\u636E\u64CD\u4F5C"},{"level":2,"title":"\u5B89\u88C5 Redis \u9A71\u52A8\u5305","slug":"\u5B89\u88C5-redis-\u9A71\u52A8\u5305"}],"relativePath":"notes/3.framework/koa/redis.md"}');
const _sfc_main = { name: "notes/3.framework/koa/redis.md" };
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h1 id="\u5728koa\u4E2D\u4F7F\u7528redis" tabindex="-1">\u5728Koa\u4E2D\u4F7F\u7528Redis <a class="header-anchor" href="#\u5728koa\u4E2D\u4F7F\u7528redis" aria-hidden="true">#</a></h1><h2 id="\u5B89\u88C5" tabindex="-1">\u5B89\u88C5 <a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a></h2><p>Redis \u7684\u5B89\u88C5\u6587\u4EF6\u4E0B\u8F7D\u5730\u5740\uFF1A<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftporadowski%2Fredis%2Freleases" target="_blank" rel="noopener noreferrer">github.com/tporadowski\u2026</a></p><p>\u5B89\u88C5\u5B8C\u6210\u540E\uFF0C\u53EF\u4EE5\u8FD0\u884C redis-server.exe \u542F\u52A8 Redis \u670D\u52A1\u5668\u3002 (\u5B89\u88C5, \u4E00\u76F4\u4E0B\u4E00\u6B65\u5373\u53EF)</p><h2 id="\u6570\u636E\u64CD\u4F5C" tabindex="-1">\u6570\u636E\u64CD\u4F5C <a class="header-anchor" href="#\u6570\u636E\u64CD\u4F5C" aria-hidden="true">#</a></h2><p>\u8FD0\u884C redis-cli.exe\uFF0C\u6253\u5F00 Redis \u7684\u547D\u4EE4\u884C\u5BA2\u6237\u7AEF\u3002</p><p>\u64CD\u4F5C\u4E00\uFF1A\u5411 Redis \u4E2D\u5B58\u50A8\u4E00\u4E2A\u5B57\u7B26\u4E32\u952E\u503C\u5BF9</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> key1 hello   </span></span>\n<span class="line"></span></code></pre></div><p>\u64CD\u4F5C\u4E8C\uFF1A\u4ECE Redis \u4E2D\u83B7\u53D6\u67D0\u4E2A\u952E\u503C\u5BF9\u503C</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">get key1          </span></span>\n<span class="line"></span></code></pre></div><p>\u64CD\u4F5C\u4E09\uFF1A\u67E5\u770B Redis \u4E2D\u6240\u6709\u7684\u952E\u503C\u5BF9 key</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">keys </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">          </span></span>\n<span class="line"></span></code></pre></div><p>\u64CD\u4F5C\u56DB\uFF1A\u5411 Redis \u4E2D\u8BBE\u7F6E\u4E00\u4E2A\u6570\u5B57\u5E76\u81EA\u589E</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">incr mynum        </span><span style="color:#676E95;font-style:italic;"># mynum \u4E3A 1</span></span>\n<span class="line"><span style="color:#A6ACCD;">incr mynum        </span><span style="color:#676E95;font-style:italic;"># mynum \u4E3A 2</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">get mynum         </span><span style="color:#676E95;font-style:italic;"># \u67E5\u770B mynum \u7ED3\u679C\u4E3A 2</span></span>\n<span class="line"></span></code></pre></div><h2 id="\u5B89\u88C5-redis-\u9A71\u52A8\u5305" tabindex="-1">\u5B89\u88C5 Redis \u9A71\u52A8\u5305 <a class="header-anchor" href="#\u5B89\u88C5-redis-\u9A71\u52A8\u5305" aria-hidden="true">#</a></h2><p>\u76EE\u524D\u4E3B\u6D41\u7684 Node.js \u7684 Redis \u9A71\u52A8\u5305\u6709\u4E24\u4E2A\uFF1A<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnoderedis%2Fnode-redis%2F" target="_blank" rel="noopener noreferrer">node-redis</a> \u548C <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fluin%2Fioredis%23readme" target="_blank" rel="noopener noreferrer">ioredis</a>\uFF0C\u8FD9\u4E24\u4E2A\u5305\u90FD\u6709\u6027\u80FD\u975E\u5E38\u9AD8\u3001\u4F7F\u7528\u65B9\u4FBF\u7684\u7279\u70B9\u3002\u800C\u540E\u8005\u7684\u6027\u80FD\u66F4\u597D\u3001\u529F\u80FD\u66F4\u5F3A\u5927</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">npm i ioredis</span></span>\n<span class="line"></span></code></pre></div><p>\u5728 koa \u4E2D\u4F7F\u7528 ioredis \u8FDE\u63A5 Redis \u670D\u52A1\u5668\uFF0C\u5E76\u53D1\u9001\u6570\u636E\u64CD\u4F5C\u547D\u4EE4</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Koa </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">koa</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Koa</span><span style="color:#A6ACCD;">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">// 1. \u5F15\u5165 ioredis</span></span>\n<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Redis </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ioredis</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">// 2. \u521B\u5EFA Redis \u5BA2\u6237\u7AEF\u5B9E\u4F8B, \u8FDE\u63A5\u6307\u5B9A\u7684 Redis \u670D\u52A1\u5668</span></span>\n<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> redis </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Redis</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// redis\u670D\u52A1\u5668\u9ED8\u8BA4\u7AEF\u53E3\u53F7</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">127.0.0.1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// redis\u670D\u52A1\u5668\u7684IP\u5730\u5740</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> ctx </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// \u4EE5\u540E\u601D\u8DEF: \u8D39\u65F6\u7684\u67E5\u8BE2, \u4E0D\u7528\u6BCF\u6B21\u90FD\u53BB\u67E5, \u5148\u770B\u770B redis \u4E2D\u5B58\u4E86\u6CA1?</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// \u5982\u679C\u5B58\u4E86, \u76F4\u63A5\u7528\u7F13\u5B58\u7684\u6570\u636E, \u5982\u679C\u6CA1\u6709\u5B58, \u5C31\u53BB\u67E5\u8BE2, \u5E76\u5C06\u67E5\u8BE2\u7684\u7ED3\u679C\u5B58\u5230 redis \u4E2D\u5373\u53EF</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// redis.get(key) \u67E5\u8BE2 (\u5F02\u6B65)</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// redis.set(key, value) \u8BBE\u7F6E (\u5F02\u6B65)</span></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">arrList</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// \u6CA1\u6709\u7F13\u5B58\u8FC7, \u9700\u8981\u8BFB\u6570\u636E\u5E93, \u5E76\u4E14\u5C06\u7ED3\u679C\u7F13\u5B58\u8D77\u6765</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u7ECF\u8FC7\u4E86\u5F88\u4E45\u5F88\u4E45\u7684\u67E5\u8BE2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">zs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">18</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ls</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">19</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ww</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">20</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">zl</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">21</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>\n<span class="line"><span style="color:#F07178;">    ]</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arr</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u7F13\u5B58\u5230redis\u4E2D</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">arrList</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">))</span></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u76F4\u63A5\u8BFB\u7F13\u5B58</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F... \u5F53\u524D\u7AEF\u53E3 3000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span>\n<span class="line"></span></code></pre></div>', 19);
const _hoisted_20 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  return openBlock(), createElementBlock("div", null, _hoisted_20);
}
var redis = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render]]);
export { __pageData, redis as default };

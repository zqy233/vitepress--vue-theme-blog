import{_ as s,o as n,c as a,a as l}from"./app.bfa9bd4b.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"android 7.0邮件添加附件 exposed beyond app through ClipData.Item.getUri()","slug":"android-7-0邮件添加附件-exposed-beyond-app-through-clipdata-item-geturi","link":"#android-7-0邮件添加附件-exposed-beyond-app-through-clipdata-item-geturi","children":[{"level":3,"title":"尝试降级安卓包版本","slug":"尝试降级安卓包版本","link":"#尝试降级安卓包版本","children":[]}]},{"level":2,"title":"Intent","slug":"intent","link":"#intent","children":[]},{"level":2,"title":"ACTION_SEND","slug":"action-send","link":"#action-send","children":[]},{"level":2,"title":"uts示例","slug":"uts示例","link":"#uts示例","children":[]},{"level":2,"title":"学习如何打包原生插件","slug":"学习如何打包原生插件","link":"#学习如何打包原生插件","children":[]},{"level":2,"title":"理解Android Studio中的Gradle","slug":"理解android-studio中的gradle","link":"#理解android-studio中的gradle","children":[{"level":3,"title":"Android Studio的gradle sync是什么?","slug":"android-studio的gradle-sync是什么","link":"#android-studio的gradle-sync是什么","children":[]},{"level":3,"title":"安装Gradle","slug":"安装gradle","link":"#安装gradle","children":[]},{"level":3,"title":"没有assembleRelease","slug":"没有assemblerelease","link":"#没有assemblerelease","children":[]},{"level":3,"title":"assembleRelease报错","slug":"assemblerelease报错","link":"#assemblerelease报错","children":[]},{"level":3,"title":"需要更改build.gradle为对应的sdk版本","slug":"需要更改build-gradle为对应的sdk版本","link":"#需要更改build-gradle为对应的sdk版本","children":[]}]},{"level":2,"title":"我的安卓插件","slug":"我的安卓插件","link":"#我的安卓插件","children":[]},{"level":2,"title":"FileProvider 路径配置策略的理解","slug":"fileprovider-路径配置策略的理解","link":"#fileprovider-路径配置策略的理解","children":[]},{"level":2,"title":"选择文件","slug":"选择文件","link":"#选择文件","children":[{"level":3,"title":"h5+ api获取图片路径","slug":"h5-api获取图片路径","link":"#h5-api获取图片路径","children":[]}]}],"relativePath":"3.框架/2.uniapp/安卓.md","lastUpdated":1720835436694}'),p={name:"3.框架/2.uniapp/安卓.md"},o=l(`<h2 id="android-7-0邮件添加附件-exposed-beyond-app-through-clipdata-item-geturi" tabindex="-1">android 7.0邮件添加附件 exposed beyond app through ClipData.Item.getUri() <a class="header-anchor" href="#android-7-0邮件添加附件-exposed-beyond-app-through-clipdata-item-geturi" aria-hidden="true">#</a></h2><p>使用uniapp官方h5+ api，实现邮件功能，运行到真机后提示No Activity found to handle Intent，手机上安装邮箱应用后，该报错没有了，并且代码可以设置邮件内容，但是添加附件会出现上方报错</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">messaging</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createMessage</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">messaging</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">TYPE_EMAIL</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">msg</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;1.com&quot;</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">msg</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">cc</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;2.com&quot;</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">msg</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">subject</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;测试邮件&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">msg</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;This is Pandora example111111111 test message&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">zipfile</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">convertAbsoluteFileSystem</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#98C379;">&quot;/storage/emulated/0&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">excelPath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;.zip&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      );</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">msg</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addAttachment</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">convertLocalFileSystemURL</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">zipfile</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">messaging</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">sendMessage</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Send success!&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">err</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Send failed!&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">err</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      );</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> msg </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">messaging</span><span style="color:#B392F0;">.createMessage(</span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">messaging</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">TYPE_EMAIL</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">msg</span><span style="color:#B392F0;">.to </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> [</span><span style="color:#FFAB70;">&quot;1.com&quot;</span><span style="color:#B392F0;">];</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">msg</span><span style="color:#B392F0;">.cc </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> [</span><span style="color:#FFAB70;">&quot;2.com&quot;</span><span style="color:#B392F0;">];</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">msg</span><span style="color:#B392F0;">.subject </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;测试邮件&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">msg</span><span style="color:#B392F0;">.body </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;This is Pandora example111111111 test message&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> zipfile </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">io</span><span style="color:#B392F0;">.convertAbsoluteFileSystem(</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#FFAB70;">&quot;/storage/emulated/0&quot;</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">+</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">this</span><span style="color:#B392F0;">.excelPath </span><span style="color:#F97583;">+</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;.zip&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      );</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">msg</span><span style="color:#B392F0;">.addAttachment(</span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">io</span><span style="color:#B392F0;">.convertLocalFileSystemURL(zipfile));</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">messaging</span><span style="color:#B392F0;">.sendMessage(</span></span>
<span class="line"><span style="color:#B392F0;">        msg</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">function</span><span style="color:#B392F0;"> (res) {</span></span>
<span class="line"><span style="color:#B392F0;">          </span><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;Send success!&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> res);</span></span>
<span class="line"><span style="color:#B392F0;">        }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">function</span><span style="color:#B392F0;"> (err) {</span></span>
<span class="line"><span style="color:#B392F0;">          </span><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;Send failed!&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> err);</span></span>
<span class="line"><span style="color:#B392F0;">        }</span></span>
<span class="line"><span style="color:#B392F0;">      );</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>学习了原生安卓怎么实现该功能，试了试h5+ api参考原生安卓的写法，也能正常运行发送邮件，但是添加附件部分经过尝试也不行</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Intent</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">android</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">importClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.content.Intent&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">mEmailIntent</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Intent</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Uri</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">android</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">importClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;android.net.Uri&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">uri</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Uri</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;mailto:&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setData</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">uri</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">EXTRA_EMAIL</span><span style="color:#ABB2BF;">, [</span><span style="color:#98C379;">&quot;347891134@qq.com&quot;</span><span style="color:#ABB2BF;">]);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">EXTRA_CC</span><span style="color:#ABB2BF;">, [</span><span style="color:#98C379;">&quot;347891134@qq.com&quot;</span><span style="color:#ABB2BF;">]);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">EXTRA_SUBJECT</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;测试邮件&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">EXTRA_TEXT</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#98C379;">&quot;This is Pandora example test message&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        );</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAction</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ACTION_SENDTO</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">main</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">android</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">runtimeMainActivity</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">main</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">startActivity</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">mEmailIntent</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> Intent </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">android</span><span style="color:#B392F0;">.importClass(</span><span style="color:#FFAB70;">&quot;android.content.Intent&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> mEmailIntent </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Intent();</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> Uri </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">android</span><span style="color:#B392F0;">.importClass(</span><span style="color:#FFAB70;">&quot;android.net.Uri&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">uri</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Uri</span><span style="color:#B392F0;">.parse(</span><span style="color:#FFAB70;">&quot;mailto:&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#B392F0;">.setData(uri);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#B392F0;">.putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">EXTRA_EMAIL</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> [</span><span style="color:#FFAB70;">&quot;347891134@qq.com&quot;</span><span style="color:#B392F0;">]);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#B392F0;">.putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">EXTRA_CC</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> [</span><span style="color:#FFAB70;">&quot;347891134@qq.com&quot;</span><span style="color:#B392F0;">]);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#B392F0;">.putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">EXTRA_SUBJECT</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;测试邮件&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#B392F0;">.putExtra(</span></span>
<span class="line"><span style="color:#B392F0;">          </span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">EXTRA_TEXT</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">          </span><span style="color:#FFAB70;">&quot;This is Pandora example test message&quot;</span></span>
<span class="line"><span style="color:#B392F0;">        );</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#B392F0;">.setAction(</span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">ACTION_SENDTO</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> main </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">android</span><span style="color:#B392F0;">.runtimeMainActivity();</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">main</span><span style="color:#B392F0;">.startActivity(mEmailIntent);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>最后通过阅读uniapp官方h5+ api源码地址</p><p><a href="https://github.com/dcloudio/H5P.Android/blob/master/feature/messaging/src/io/dcloud/adapter/messaging/DHMessagCenter.java" target="_blank" rel="noreferrer">https://github.com/dcloudio/H5P.Android/blob/master/feature/messaging/src/io/dcloud/adapter/messaging/DHMessagCenter.java</a></p><p>结合网上资料，发现原因在于版本问题，Android7.0以上更改了文件url处理方式</p><p>参考大神代码，实现的分享插件<a href="https://ext.dcloud.net.cn/plugin?id=2307%EF%BC%8C%E5%85%B6%E4%B8%AD%E6%98%AF%E8%BF%99%E6%A0%B7%E8%A7%A3%E5%86%B3%E7%9A%84https://github.com/lifejwang11/FileShare/blob/master/Android/sharefile/src/main/java/com/wgg/sharefile/Share.java" target="_blank" rel="noreferrer">https://ext.dcloud.net.cn/plugin?id=2307，其中是这样解决的https://github.com/lifejwang11/FileShare/blob/master/Android/sharefile/src/main/java/com/wgg/sharefile/Share.java</a></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C678DD;">package</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">com.wgg.sharefile</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.content.Context</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.net.Uri</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.os.Build</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.support.v4.content.FileProvider</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">java.io.File</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">FileUtils</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">static</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Uri</span><span style="color:#61AFEF;"> getUri</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Context</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">context</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">filePath</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">File</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">tempFile</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">File</span><span style="color:#ABB2BF;">(filePath);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//判断版本</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Build</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">VERSION</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">SDK_INT</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Build</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">VERSION_CODES</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">N</span><span style="color:#ABB2BF;">) {   </span><span style="color:#7F848E;font-style:italic;">//如果在Android7.0以上,使用FileProvider获取Uri</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">FileProvider</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUriForFile</span><span style="color:#ABB2BF;">(context, </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getPackageName</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;.provider&quot;</span><span style="color:#ABB2BF;">, tempFile);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//                return FileProvider.getUriForFile(context, &quot;uni.UNI899E01B.fileprovider&quot;, tempFile);</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Exception</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {    </span><span style="color:#7F848E;font-style:italic;">//否则使用Uri.fromFile(file)方法获取Uri</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Uri</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fromFile</span><span style="color:#ABB2BF;">(tempFile);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">com</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">wgg</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">sharefile</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">content</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Context</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">net</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Uri</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">os</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Build</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">support</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">v4</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">content</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">FileProvider</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">java</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">io</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">File</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">class</span><span style="color:#B392F0;"> FileUtils {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">public</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">static</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">Uri</span><span style="color:#B392F0;"> getUri(</span><span style="color:#F97583;">Context</span><span style="color:#B392F0;"> context</span><span style="color:#BBBBBB;">,</span><span style="color:#F97583;">String</span><span style="color:#B392F0;"> filePath){</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">File</span><span style="color:#B392F0;"> tempFile </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> File(filePath);</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#6B737C;">//判断版本</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">Build</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">VERSION</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">SDK_INT</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">&gt;=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Build</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">VERSION_CODES</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">N</span><span style="color:#B392F0;">) {   </span><span style="color:#6B737C;">//如果在Android7.0以上,使用FileProvider获取Uri</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">try</span><span style="color:#B392F0;">{</span></span>
<span class="line"><span style="color:#B392F0;">                </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">FileProvider</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getUriForFile(context</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getPackageName() </span><span style="color:#F97583;">+</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;.provider&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> tempFile);</span></span>
<span class="line"><span style="color:#6B737C;">//                return FileProvider.getUriForFile(context, &quot;uni.UNI899E01B.fileprovider&quot;, tempFile);</span></span>
<span class="line"><span style="color:#B392F0;">            }</span><span style="color:#F97583;">catch</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">Exception</span><span style="color:#B392F0;"> e){</span></span>
<span class="line"><span style="color:#B392F0;">                </span><span style="color:#79B8FF;">e</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">printStackTrace();</span></span>
<span class="line"><span style="color:#B392F0;">            }</span></span>
<span class="line"><span style="color:#B392F0;">        } </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> {    </span><span style="color:#6B737C;">//否则使用Uri.fromFile(file)方法获取Uri</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Uri</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">fromFile(tempFile);</span></span>
<span class="line"><span style="color:#B392F0;">        }</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">null</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="尝试降级安卓包版本" tabindex="-1">尝试降级安卓包版本 <a class="header-anchor" href="#尝试降级安卓包版本" aria-hidden="true">#</a></h3><p>uniapp manifest中设置targetSdkVersion小于23，把安卓包降到低版本，这样安装包时会提示低版本，但是又会导致新问题</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">/* 应用发布信息 */</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;distribute&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;">/* android打包配置 */</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">&quot;android&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">&quot;permissions&quot;</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">         </span></span>
<span class="line"><span style="color:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">&quot;targetSdkVersion&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">22</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;"> </span><span style="color:#6B737C;">/* 应用发布信息 */</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#FFAB70;">&quot;distribute&quot;</span><span style="color:#B392F0;">: {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#6B737C;">/* android打包配置 */</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F8F8F8;">&quot;android&quot;</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F8F8F8;">&quot;permissions&quot;</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> [</span></span>
<span class="line"><span style="color:#B392F0;">         </span></span>
<span class="line"><span style="color:#B392F0;">        ]</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F8F8F8;">&quot;targetSdkVersion&quot;</span><span style="color:#BBBBBB;">:</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">22</span></span>
<span class="line"><span style="color:#B392F0;">      }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>提示没有权限，参考大神代码，实现的分享插件<a href="https://ext.dcloud.net.cn/plugin?id=2307%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%8E%9F%E7%94%9F%E5%AE%89%E5%8D%93%E4%BB%A3%E7%A0%81%E6%98%AF%E8%BF%99%E6%A0%B7%E8%A7%A3%E5%86%B3%E7%9A%84https://github.com/lifejwang11/FileShare/blob/master/Android/sharefile/src/main/java/com/wgg/sharefile/Share.java" target="_blank" rel="noreferrer">https://ext.dcloud.net.cn/plugin?id=2307，其中原生安卓代码是这样解决的https://github.com/lifejwang11/FileShare/blob/master/Android/sharefile/src/main/java/com/wgg/sharefile/Share.java</a></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> (</span><span style="color:#E5C07B;">Build</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">VERSION</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">SDK_INT</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Build</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">VERSION_CODES</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">KITKAT</span><span style="color:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E06C75;">            </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">ResolveInfo</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> resInfoList </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">activity</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getPackageManager</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">queryIntentActivities</span><span style="color:#ABB2BF;">(shareIntent, </span><span style="color:#E5C07B;">PackageManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">MATCH_DEFAULT_ONLY</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">            </span><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> (</span><span style="color:#E5C07B;">ResolveInfo</span><span style="color:#E06C75;"> resolveInfo </span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> resInfoList) {</span></span>
<span class="line"><span style="color:#E06C75;">                </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> packageName </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">resolveInfo</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">activityInfo</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">packageName</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">                </span><span style="color:#E5C07B;">activity</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">grantUriPermission</span><span style="color:#ABB2BF;">(packageName, shareFileUri, </span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">FLAG_GRANT_READ_URI_PERMISSION</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;">        }</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">Build</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">VERSION</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">SDK_INT</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">&lt;=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Build</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">VERSION_CODES</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">KITKAT</span><span style="color:#B392F0;">) {</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">List</span><span style="color:#B392F0;">&lt;</span><span style="color:#F97583;">ResolveInfo</span><span style="color:#B392F0;">&gt; resInfoList </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">activity</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getPackageManager()</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">queryIntentActivities(shareIntent</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">PackageManager</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">MATCH_DEFAULT_ONLY</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">for</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">ResolveInfo</span><span style="color:#B392F0;"> resolveInfo </span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> resInfoList) {</span></span>
<span class="line"><span style="color:#B392F0;">                </span><span style="color:#F97583;">String</span><span style="color:#B392F0;"> packageName </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">resolveInfo</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">activityInfo</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">packageName</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">                </span><span style="color:#79B8FF;">activity</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">grantUriPermission(packageName</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> shareFileUri</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">FLAG_GRANT_READ_URI_PERMISSION</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            }</span></span>
<span class="line"><span style="color:#B392F0;">        }</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>所以最终还是要通过安卓原生代码来解决，开始学习安卓开发，打包安卓原生插件</p><h2 id="intent" tabindex="-1">Intent <a class="header-anchor" href="#intent" aria-hidden="true">#</a></h2><p>在 Android 开发中，Intent 是一个重要的概念，它用于在不同的组件之间传递消息、执行操作或启动活动（Activity）。Intent 可以在应用内部组件之间进行通信，也可以与其他应用程序进行通信。</p><p>在这段代码中，<code>Intent sendIntent = new Intent(Intent.ACTION_SEND);</code> 创建了一个新的 Intent 实例，并指定了其动作为发送操作。这意味着这个 Intent 被用于启动一个发送的动作，通常是启动一个应用程序来发送数据（在这种情况下是多媒体消息）。</p><p>Intent 可以包含各种信息，比如操作的类型、数据的 URI、数据的 MIME 类型等。在这个例子中，通过 <code>sendIntent.setType(&quot;*/*&quot;);</code> 设置了要发送的数据类型为任意类型，表示该 Intent 可以发送任意类型的数据。</p><p>一旦创建了 Intent 实例，并设置了必要的信息，就可以使用 <code>startActivity()</code> 方法来启动该 Intent，从而执行相应的操作。在这个例子中，<code>_messaging.mWebview.getActivity().startActivity(sendIntent);</code> 启动了发送 Intent，使得用户可以选择一个适合的应用程序来发送多媒体消息。</p><p>总的来说，Intent 是在 Android 中用于执行各种操作和通信的一种重要机制，它允许不同组件之间进行交互，并在 Android 应用程序中实现了丰富的功能。</p><h2 id="action-send" tabindex="-1"><code>ACTION_SEND</code> <a class="header-anchor" href="#action-send" aria-hidden="true">#</a></h2><p>官方源码实现邮件发送 <a href="https://github.com/dcloudio/H5P.Android/blob/master/feature/messaging/src/io/dcloud/adapter/messaging/DHMessagCenter.java" target="_blank" rel="noreferrer">https://github.com/dcloudio/H5P.Android/blob/master/feature/messaging/src/io/dcloud/adapter/messaging/DHMessagCenter.java</a></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">if</span><span style="color:#E06C75;">( attachMentsSize </span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">1</span><span style="color:#E06C75;"> ){</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAction</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ACTION_SEND_MULTIPLE</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putParcelableArrayListExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_STREAM</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">pMessaging</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">mAttachments</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setType</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message/rfc822&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">  }</span><span style="color:#C678DD;">else</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">if</span><span style="color:#E06C75;">( attachMentsSize </span><span style="color:#56B6C2;">==</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">1</span><span style="color:#E06C75;"> ){</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_STREAM</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">pMessaging</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">mAttachments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setType</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">PdrUtil</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMimeType</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">pMessaging</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">mAttachments</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">getPath</span><span style="color:#ABB2BF;">()));</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setType</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;message/rfc882&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAction</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ACTION_SEND</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">  }</span><span style="color:#C678DD;">else</span><span style="color:#E06C75;">{</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAction</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ACTION_SENDTO</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">  }</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;">( attachMentsSize </span><span style="color:#F97583;">&gt;</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">1</span><span style="color:#B392F0;"> ){</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setAction(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">ACTION_SEND_MULTIPLE</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putParcelableArrayListExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_STREAM</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">pMessaging</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">mAttachments</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setType(</span><span style="color:#FFAB70;">&quot;message/rfc822&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">if</span><span style="color:#B392F0;">( attachMentsSize </span><span style="color:#F97583;">==</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">1</span><span style="color:#B392F0;"> ){</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_STREAM</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">pMessaging</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">mAttachments</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">get(</span><span style="color:#F8F8F8;">0</span><span style="color:#B392F0;">));</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setType(</span><span style="color:#79B8FF;">PdrUtil</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getMimeType(</span><span style="color:#79B8FF;">pMessaging</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">mAttachments</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">get(</span><span style="color:#F8F8F8;">0</span><span style="color:#B392F0;">)</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getPath()));</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setType(</span><span style="color:#FFAB70;">&quot;message/rfc882&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setAction(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">ACTION_SEND</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span><span style="color:#F97583;">else</span><span style="color:#B392F0;">{</span></span>
<span class="line"><span style="color:#B392F0;">	</span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setAction(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">ACTION_SENDTO</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>ACTION_SENDTO</code> 动作通常用于发送纯文本邮件。</p><p><code>ACTION_SEND</code> 动作可以启动一个发送邮件的操作。</p><p><code>ACTION_SEND_MULTIPLE</code> 动作则用于发送多个附件的邮件。</p><p>使用 <code>ACTION_SEND</code> 动作的 Intent，可以通过 <code>EXTRA_STREAM</code> 属性来附加一个附件。这样，邮件客户端就可以从 Intent 中获取附件并将其添加到邮件中，然后发送邮件。</p><p><code>mEmailIntent.setType(&quot;message/rfc822&quot;)</code>邮件的 MIME 类型设置为 <code>message/rfc822</code>，这是邮件的标准类型，表示邮件内容遵循 RFC 822 标准。这个设置表明邮件内容是符合邮件格式规范的文本内容。</p><h2 id="uts示例" tabindex="-1">uts示例 <a class="header-anchor" href="#uts示例" aria-hidden="true">#</a></h2><p>也是一种实现原生插件的写法，<a href="https://ext.dcloud.net.cn/plugin?id=9295%EF%BC%8C%E4%BD%86%E6%98%AF%E7%A0%94%E7%A9%B6%E5%90%8E%E5%8F%91%E7%8E%B0%E5%A4%AA%E5%A4%8D%E6%9D%82%E4%BA%86%EF%BC%8C%E6%94%BE%E5%BC%83%E6%94%BE%E5%BC%83" target="_blank" rel="noreferrer">https://ext.dcloud.net.cn/plugin?id=9295，但是研究后发现太复杂了，放弃放弃</a></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Context</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;android.content.Context&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">BatteryManager</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;android.os.BatteryManager&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">GetBatteryInfo</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">GetBatteryInfoOptions</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">GetBatteryInfoSuccess</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">GetBatteryInfoResult</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">GetBatteryInfoSync</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;../interface.uts&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">IntentFilter</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;android.content.IntentFilter&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Intent</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;android.content.Intent&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * 异步获取电量</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">getBatteryInfo</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">GetBatteryInfo</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">GetBatteryInfoOptions</span></span>
<span class="line"><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">UTSAndroid</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getAppContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">manager</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSystemService</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">Context</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_SERVICE</span></span>
<span class="line"><span style="color:#ABB2BF;">    ) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">level</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">manager</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getIntProperty</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_PROPERTY_CAPACITY</span></span>
<span class="line"><span style="color:#ABB2BF;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">ifilter</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">IntentFilter</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ACTION_BATTERY_CHANGED</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">batteryStatus</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">registerReceiver</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">ifilter</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">batteryStatus</span><span style="color:#ABB2BF;">?.</span><span style="color:#61AFEF;">getIntExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">EXTRA_STATUS</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_STATUS_CHARGING</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">||</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_STATUS_FULL</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">GetBatteryInfoSuccess</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">errMsg</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;getBatteryInfo:ok&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">level</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    };</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">success</span><span style="color:#ABB2BF;">?.(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">complete</span><span style="color:#ABB2BF;">?.(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">UniError</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">&quot;uni-getBatteryInfo&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">1001</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#98C379;">&quot;getBatteryInfo:fail getAppContext is null&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    );</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fail</span><span style="color:#ABB2BF;">?.(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">complete</span><span style="color:#ABB2BF;">?.(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * 同步获取电量示例</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">getBatteryInfoSync</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">GetBatteryInfoSync</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (): </span><span style="color:#E5C07B;">GetBatteryInfoResult</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">UTSAndroid</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getAppContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">manager</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSystemService</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Context</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_SERVICE</span></span>
<span class="line"><span style="color:#ABB2BF;">      ) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">level</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">manager</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getIntProperty</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_PROPERTY_CAPACITY</span></span>
<span class="line"><span style="color:#ABB2BF;">      );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">ifilter</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">IntentFilter</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ACTION_BATTERY_CHANGED</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">batteryStatus</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">registerReceiver</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">ifilter</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">batteryStatus</span><span style="color:#ABB2BF;">?.</span><span style="color:#61AFEF;">getIntExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">EXTRA_STATUS</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">let</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_STATUS_CHARGING</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">||</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BatteryManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">BATTERY_STATUS_FULL</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">GetBatteryInfoResult</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">level</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">level</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       * 无有效上下文</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       */</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">GetBatteryInfoResult</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">level</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">isCharging</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      };</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> Context </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;android.content.Context&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> BatteryManager </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;android.os.BatteryManager&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  GetBatteryInfo</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  GetBatteryInfoOptions</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  GetBatteryInfoSuccess</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  GetBatteryInfoResult</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">  GetBatteryInfoSync</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">} </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;../interface.uts&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> IntentFilter </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;android.content.IntentFilter&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> Intent </span><span style="color:#F97583;">from</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;android.content.Intent&quot;</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">/**</span></span>
<span class="line"><span style="color:#6B737C;"> * 异步获取电量</span></span>
<span class="line"><span style="color:#6B737C;"> */</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> getBatteryInfo</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfo </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">function</span><span style="color:#B392F0;"> (</span></span>
<span class="line"><span style="color:#B392F0;">  options</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfoOptions</span></span>
<span class="line"><span style="color:#B392F0;">) {</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">UTSAndroid</span><span style="color:#B392F0;">.getAppContext();</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (context </span><span style="color:#F97583;">!=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">null</span><span style="color:#B392F0;">) {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">manager</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#B392F0;">.getSystemService(</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">Context</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_SERVICE</span></span>
<span class="line"><span style="color:#B392F0;">    ) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> BatteryManager;</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">level</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">manager</span><span style="color:#B392F0;">.getIntProperty(</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_PROPERTY_CAPACITY</span></span>
<span class="line"><span style="color:#B392F0;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> ifilter </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> IntentFilter(</span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">ACTION_BATTERY_CHANGED</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> batteryStatus </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#B392F0;">.registerReceiver(</span><span style="color:#79B8FF;">null</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> ifilter);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> status </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">batteryStatus</span><span style="color:#B392F0;">?.getIntExtra(</span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">EXTRA_STATUS</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">-</span><span style="color:#F8F8F8;">1</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> isCharging </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#B392F0;">      status </span><span style="color:#F97583;">==</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_STATUS_CHARGING</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#B392F0;">      status </span><span style="color:#F97583;">==</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_STATUS_FULL</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">res</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfoSuccess </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      errMsg</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;getBatteryInfo:ok&quot;</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      level</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      isCharging</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> isCharging</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">    };</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">options</span><span style="color:#B392F0;">.success?.(res);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">options</span><span style="color:#B392F0;">.complete?.(res);</span></span>
<span class="line"><span style="color:#B392F0;">  } </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">res</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> UniError(</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#FFAB70;">&quot;uni-getBatteryInfo&quot;</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F8F8F8;">1001</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#FFAB70;">&quot;getBatteryInfo:fail getAppContext is null&quot;</span></span>
<span class="line"><span style="color:#B392F0;">    );</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">options</span><span style="color:#B392F0;">.fail?.(res);</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#79B8FF;">options</span><span style="color:#B392F0;">.complete?.(res);</span></span>
<span class="line"><span style="color:#B392F0;">  }</span></span>
<span class="line"><span style="color:#B392F0;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">/**</span></span>
<span class="line"><span style="color:#6B737C;"> * 同步获取电量示例</span></span>
<span class="line"><span style="color:#6B737C;"> */</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">getBatteryInfoSync</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfoSync </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#B392F0;">  </span><span style="color:#F97583;">function</span><span style="color:#B392F0;"> ()</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfoResult {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">UTSAndroid</span><span style="color:#B392F0;">.getAppContext();</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (context </span><span style="color:#F97583;">!=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">null</span><span style="color:#B392F0;">) {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">manager</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#B392F0;">.getSystemService(</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">Context</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_SERVICE</span></span>
<span class="line"><span style="color:#B392F0;">      ) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> BatteryManager;</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">level</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">manager</span><span style="color:#B392F0;">.getIntProperty(</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_PROPERTY_CAPACITY</span></span>
<span class="line"><span style="color:#B392F0;">      );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> ifilter </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> IntentFilter(</span><span style="color:#79B8FF;">Intent</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">ACTION_BATTERY_CHANGED</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> batteryStatus </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#B392F0;">.registerReceiver(</span><span style="color:#79B8FF;">null</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> ifilter);</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> status </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">batteryStatus</span><span style="color:#B392F0;">?.getIntExtra(</span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">EXTRA_STATUS</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">-</span><span style="color:#F8F8F8;">1</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">let</span><span style="color:#B392F0;"> isCharging </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#B392F0;">        status </span><span style="color:#F97583;">==</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_STATUS_CHARGING</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#B392F0;">        status </span><span style="color:#F97583;">==</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">BatteryManager</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">BATTERY_STATUS_FULL</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">res</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfoResult </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">        level</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> level</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        isCharging</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> isCharging</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> res;</span></span>
<span class="line"><span style="color:#B392F0;">    } </span><span style="color:#F97583;">else</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#6B737C;">/**</span></span>
<span class="line"><span style="color:#6B737C;">       * 无有效上下文</span></span>
<span class="line"><span style="color:#6B737C;">       */</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">const</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">res</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> GetBatteryInfoResult </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> {</span></span>
<span class="line"><span style="color:#B392F0;">        level</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">-</span><span style="color:#F8F8F8;">1</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        isCharging</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">false</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">      };</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#F97583;">return</span><span style="color:#B392F0;"> res;</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">  };</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><h2 id="学习如何打包原生插件" tabindex="-1">学习如何打包原生插件 <a class="header-anchor" href="#学习如何打包原生插件" aria-hidden="true">#</a></h2><p><a href="https://juejin.cn/post/7194743378830409783" target="_blank" rel="noreferrer">https://juejin.cn/post/7194743378830409783</a></p><p><a href="https://juejin.cn/post/7195018409543729189/" target="_blank" rel="noreferrer">https://juejin.cn/post/7195018409543729189/</a></p><h2 id="理解android-studio中的gradle" tabindex="-1">理解Android Studio中的Gradle <a class="header-anchor" href="#理解android-studio中的gradle" aria-hidden="true">#</a></h2><p><a href="https://zhuanlan.zhihu.com/p/139685763" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/139685763</a></p><h3 id="android-studio的gradle-sync是什么" tabindex="-1">Android Studio的gradle sync是什么? <a class="header-anchor" href="#android-studio的gradle-sync是什么" aria-hidden="true">#</a></h3><p><a href="https://www.zhihu.com/question/369909080" target="_blank" rel="noreferrer">https://www.zhihu.com/question/369909080</a></p><p>和Maven一样是项目管理工具，可以对代码进行构建、依赖管理。</p><p>不用Maven、Gradle这些类似工具你只能手动加载包到你的Libs下，麻烦且容易出问题。</p><p>现在Web开发一般都会采用Maven，而Android开发由于Google推出的AS是指定的Gradle自然也就采用了它。</p><p>Gradle sync就是开始执行Gradle脚本，一般会将声明中的包库进行下载，由于不可描述的原因在国内的确存在fail的情况，作为程序员请先学会科学的上网方式。</p><h3 id="安装gradle" tabindex="-1">安装Gradle <a class="header-anchor" href="#安装gradle" aria-hidden="true">#</a></h3><p>下载慢解决方案：使用浏览器下载到本地，然后配置Android Studio使用本地路径的Gradle：</p><p>1.<a href="https://gradle.org/releases/%E7%9B%B4%E6%8E%A5%E5%AE%98%E6%96%B9%E4%B8%8B%E8%BD%BDbinary-only%E7%89%88%E6%9C%AC%EF%BC%8C%E6%A0%BC%E5%BC%8F%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84%EF%BC%9Agradle-7.2-bin%EF%BC%8C%E8%BF%99%E7%A7%8D%E5%8C%85%E5%B0%B1%E6%98%AF%E6%89%80%E9%9C%80%E7%9A%84%E3%80%82" target="_blank" rel="noreferrer">https://gradle.org/releases/直接官方下载binary-only版本，格式是这样的：gradle-7.2-bin，这种包就是所需的。</a></p><p>2.修改Android Studio使用本地路径的Gradle，然后重新同步（同步指的就是点击右上角的小象图标，就会触发gradle），具体操作：解压gradle压缩包，file&gt;setttings&gt;gradle中使用本地路径解压后的gradle，默认置Android Studio使用的高版本java，可以安装7.2，7.2以上的版本没有尝试，参考文章：<a href="https://blog.csdn.net/C_biubiubiu/article/details/109863975%E3%80%82" target="_blank" rel="noreferrer">https://blog.csdn.net/C_biubiubiu/article/details/109863975。</a></p><h3 id="没有assemblerelease" tabindex="-1">没有assembleRelease <a class="header-anchor" href="#没有assemblerelease" aria-hidden="true">#</a></h3><p>file -&gt; setting -&gt; Experimental -&gt; 勾上 Configure all Gradle tasks during Gradle Sync (this can make Gradle Sync slower)选项，然后再选择file -&gt; Sync Project......就有了</p><h3 id="assemblerelease报错" tabindex="-1">assembleRelease报错 <a class="header-anchor" href="#assemblerelease报错" aria-hidden="true">#</a></h3><p><a href="https://stackoverflow.com/questions/67782975/how-to-fix-the-module-java-base-does-not-opens-java-io-to-unnamed-module" target="_blank" rel="noreferrer">https://stackoverflow.com/questions/67782975/how-to-fix-the-module-java-base-does-not-opens-java-io-to-unnamed-module</a></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">org.gradle.jvmargs</span><span style="color:#ABB2BF;">=-Xmx1536M </span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;">--add-exports=java.base/sun.nio.ch=ALL-UNNAMED </span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;">--add-opens=java.base/java.lang=ALL-UNNAMED </span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;">--add-opens=java.base/java.lang.reflect=ALL-UNNAMED </span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;">--add-opens=java.base/java.io=ALL-UNNAMED </span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#ABB2BF;">--add-exports=jdk.unsupported/sun.misc=ALL-UNNAMED</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;">org.gradle.jvmargs=-Xmx1536M \\</span></span>
<span class="line"><span style="color:#B392F0;">--add-exports=java.base/sun.nio.ch=ALL-UNNAMED \\</span></span>
<span class="line"><span style="color:#B392F0;">--add-opens=java.base/java.lang=ALL-UNNAMED \\</span></span>
<span class="line"><span style="color:#B392F0;">--add-opens=java.base/java.lang.reflect=ALL-UNNAMED \\</span></span>
<span class="line"><span style="color:#B392F0;">--add-opens=java.base/java.io=ALL-UNNAMED \\</span></span>
<span class="line"><span style="color:#B392F0;">--add-exports=jdk.unsupported/sun.misc=ALL-UNNAMED</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="需要更改build-gradle为对应的sdk版本" tabindex="-1">需要更改build.gradle为对应的sdk版本 <a class="header-anchor" href="#需要更改build-gradle为对应的sdk版本" aria-hidden="true">#</a></h3><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">compileSdkVersion </span><span style="color:#D19A66;">30</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;">compileSdkVersion </span><span style="color:#F8F8F8;">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="我的安卓插件" tabindex="-1">我的安卓插件 <a class="header-anchor" href="#我的安卓插件" aria-hidden="true">#</a></h2><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#C678DD;">package</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">com.example.mylibrary</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">com.alibaba.fastjson.JSONArray</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">com.alibaba.fastjson.JSONObject</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">io.dcloud.feature.uniapp.annotation.UniJSMethod</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">io.dcloud.feature.uniapp.bridge.UniJSCallback</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">io.dcloud.feature.uniapp.common.UniModule</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.app.Activity</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.content.Intent</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.content.pm.PackageManager</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.content.pm.ResolveInfo</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.net.Uri</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">android.os.Build</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">androidx.core.content.FileProvider</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">java.io.File</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">java.util.List</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 一定要继承UniModule</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">testModule</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UniModule</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 使用UniJSMethod注解，才能使用js调用</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">UniJSMethod</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">uiThread</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">true</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;">  email</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">JSONObject</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">UniJSCallback</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">callback</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">mUniSDKInstance</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getContext</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">instanceof</span><span style="color:#ABB2BF;"> Activity) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Activity</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (Activity) </span><span style="color:#E5C07B;">mUniSDKInstance</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">filePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getString</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;filePath&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Uri</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">streamPath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">FileProvider</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUriForFile</span><span style="color:#ABB2BF;">(context, </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getPackageName</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;.provider&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">File</span><span style="color:#ABB2BF;">(filePath));</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">mEmailIntent</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Intent</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Uri</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">uri</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Uri</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;mailto:&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">JSONArray</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getJSONArray</span><span style="color:#ABB2BF;">( </span><span style="color:#98C379;">&quot;to&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">//创建一个与JSONArray 长度相同的String数组</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;">strings_to</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[</span><span style="color:#E5C07B;">to</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">size</span><span style="color:#ABB2BF;">()];</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">//使用JSONArray 中的toArray进行转换</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;">strings_arr_to</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">to</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toArray</span><span style="color:#ABB2BF;">(strings_to);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_EMAIL</span><span style="color:#ABB2BF;">,  strings_arr_to);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">JSONArray</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">cc</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getJSONArray</span><span style="color:#ABB2BF;">( </span><span style="color:#98C379;">&quot;cc&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;">strings_cc</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[</span><span style="color:#E5C07B;">cc</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">size</span><span style="color:#ABB2BF;">()];</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;">strings_arr_cc</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">cc</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toArray</span><span style="color:#ABB2BF;">(strings_cc);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_CC</span><span style="color:#ABB2BF;">, strings_arr_cc);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_SUBJECT</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getString</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;subject&quot;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_TEXT</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getString</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;body&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            );</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">putExtra</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">EXTRA_STREAM</span><span style="color:#ABB2BF;">, streamPath);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAction</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ACTION_SEND</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setData</span><span style="color:#ABB2BF;">(uri);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mEmailIntent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setType</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;*/*&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Build</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">VERSION</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">SDK_INT</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Build</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">VERSION_CODES</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">KITKAT</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">ResolveInfo</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;">resInfoList</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getPackageManager</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">queryIntentActivities</span><span style="color:#ABB2BF;">(mEmailIntent, </span><span style="color:#E5C07B;">PackageManager</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">MATCH_DEFAULT_ONLY</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">ResolveInfo</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">resolveInfo</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> resInfoList) {</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">packageName</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">resolveInfo</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">activityInfo</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">packageName</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">grantUriPermission</span><span style="color:#ABB2BF;">(packageName, streamPath, </span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">FLAG_GRANT_READ_URI_PERMISSION</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">startActivity</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Intent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createChooser</span><span style="color:#ABB2BF;">(mEmailIntent, </span><span style="color:#98C379;">&quot;邮件&quot;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">callback</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">invoke</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">JSONObject</span><span style="color:#ABB2BF;">() {{</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;成功&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            }});</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        }</span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Exception</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">callback</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">invoke</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">JSONObject</span><span style="color:#ABB2BF;">() {{</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;result&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMessage</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">            }});</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">com</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">example</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">mylibrary</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">com</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">alibaba</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">fastjson</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">JSONArray</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">com</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">alibaba</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">fastjson</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">JSONObject</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">io</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">dcloud</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">feature</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">uniapp</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">annotation</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">UniJSMethod</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">io</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">dcloud</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">feature</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">uniapp</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">bridge</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">UniJSCallback</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">io</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">dcloud</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">feature</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">uniapp</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">common</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">UniModule</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">app</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Activity</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">content</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Intent</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">content</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">pm</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">PackageManager</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">content</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">pm</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">ResolveInfo</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">net</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Uri</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">android</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">os</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">Build</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">androidx</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">core</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">content</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">FileProvider</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">java</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">io</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">File</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">java</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">util</span><span style="color:#BBBBBB;">.</span><span style="color:#F97583;">List</span><span style="color:#B392F0;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C;">// 一定要继承UniModule</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">class</span><span style="color:#B392F0;"> testModule </span><span style="color:#F97583;">extends</span><span style="color:#B392F0;"> UniModule {</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#6B737C;">// 使用UniJSMethod注解，才能使用js调用</span></span>
<span class="line"><span style="color:#B392F0;">    @</span><span style="color:#F97583;">UniJSMethod</span><span style="color:#B392F0;">(uiThread </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;">)</span></span>
<span class="line"><span style="color:#B392F0;">    </span><span style="color:#F97583;">public</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">void</span><span style="color:#B392F0;">  email (</span><span style="color:#F97583;">JSONObject</span><span style="color:#B392F0;"> options</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">UniJSCallback</span><span style="color:#B392F0;"> callback) {</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">try</span><span style="color:#B392F0;">{</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">mUniSDKInstance</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getContext() </span><span style="color:#F97583;">instanceof</span><span style="color:#B392F0;"> Activity) {</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">Activity</span><span style="color:#B392F0;"> context </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> (Activity) </span><span style="color:#79B8FF;">mUniSDKInstance</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getContext();</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">String</span><span style="color:#B392F0;"> filePath </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">options</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getString(</span><span style="color:#FFAB70;">&quot;filePath&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">Uri</span><span style="color:#B392F0;"> streamPath </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">FileProvider</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getUriForFile(context</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getPackageName() </span><span style="color:#F97583;">+</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;.provider&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> File(filePath));</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">Intent</span><span style="color:#B392F0;"> mEmailIntent </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Intent();</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">Uri</span><span style="color:#B392F0;"> uri </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Uri</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">parse(</span><span style="color:#FFAB70;">&quot;mailto:&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">JSONArray</span><span style="color:#B392F0;"> to </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">options</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getJSONArray( </span><span style="color:#FFAB70;">&quot;to&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#6B737C;">//创建一个与JSONArray 长度相同的String数组</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">String</span><span style="color:#B392F0;">[] strings_to </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">String</span><span style="color:#B392F0;">[</span><span style="color:#79B8FF;">to</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">size()];</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#6B737C;">//使用JSONArray 中的toArray进行转换</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">String</span><span style="color:#B392F0;">[] strings_arr_to </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">to</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">toArray(strings_to);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_EMAIL</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;">  strings_arr_to);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">JSONArray</span><span style="color:#B392F0;"> cc </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">options</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getJSONArray( </span><span style="color:#FFAB70;">&quot;cc&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">String</span><span style="color:#B392F0;">[] strings_cc </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">String</span><span style="color:#B392F0;">[</span><span style="color:#79B8FF;">cc</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">size()];</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">String</span><span style="color:#B392F0;">[] strings_arr_cc </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">cc</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">toArray(strings_cc);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_CC</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> strings_arr_cc);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_SUBJECT</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">options</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getString(</span><span style="color:#FFAB70;">&quot;subject&quot;</span><span style="color:#B392F0;">));</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putExtra(</span></span>
<span class="line"><span style="color:#B392F0;">                    </span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_TEXT</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">                    </span><span style="color:#79B8FF;">options</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getString(</span><span style="color:#FFAB70;">&quot;body&quot;</span><span style="color:#B392F0;">)</span></span>
<span class="line"><span style="color:#B392F0;">            );</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">putExtra(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">EXTRA_STREAM</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> streamPath);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setAction(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">ACTION_SEND</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setData(uri);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">mEmailIntent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">setType(</span><span style="color:#FFAB70;">&quot;*/*&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#F97583;">if</span><span style="color:#B392F0;"> (</span><span style="color:#79B8FF;">Build</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">VERSION</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">SDK_INT</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">&lt;=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Build</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">VERSION_CODES</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">KITKAT</span><span style="color:#B392F0;">) {</span></span>
<span class="line"><span style="color:#B392F0;">                </span><span style="color:#F97583;">List</span><span style="color:#B392F0;">&lt;</span><span style="color:#F97583;">ResolveInfo</span><span style="color:#B392F0;">&gt; resInfoList </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">context</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getPackageManager()</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">queryIntentActivities(mEmailIntent</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">PackageManager</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">MATCH_DEFAULT_ONLY</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">                </span><span style="color:#F97583;">for</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">ResolveInfo</span><span style="color:#B392F0;"> resolveInfo </span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> resInfoList) {</span></span>
<span class="line"><span style="color:#B392F0;">                    </span><span style="color:#F97583;">String</span><span style="color:#B392F0;"> packageName </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">resolveInfo</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">activityInfo</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">packageName</span><span style="color:#B392F0;">;</span></span>
<span class="line"><span style="color:#B392F0;">                    </span><span style="color:#79B8FF;">context</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">grantUriPermission(packageName</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> streamPath</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#79B8FF;">FLAG_GRANT_READ_URI_PERMISSION</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">                }</span></span>
<span class="line"><span style="color:#B392F0;">            }</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">context</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">startActivity(</span><span style="color:#79B8FF;">Intent</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">createChooser(mEmailIntent</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;邮件&quot;</span><span style="color:#B392F0;">));</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">callback</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">invoke(</span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> JSONObject() {{</span></span>
<span class="line"><span style="color:#B392F0;">                put(</span><span style="color:#FFAB70;">&quot;code&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F8F8F8;">200</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">                put(</span><span style="color:#FFAB70;">&quot;result&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;成功&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">            }});</span></span>
<span class="line"><span style="color:#B392F0;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">        }</span><span style="color:#F97583;">catch</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">Exception</span><span style="color:#B392F0;"> e){</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">e</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">printStackTrace();</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">callback</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">invoke(</span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> JSONObject() {{</span></span>
<span class="line"><span style="color:#B392F0;">                put(</span><span style="color:#FFAB70;">&quot;code&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#F97583;">-</span><span style="color:#F8F8F8;">1</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">                put(</span><span style="color:#FFAB70;">&quot;result&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">e</span><span style="color:#BBBBBB;">.</span><span style="color:#B392F0;">getMessage());</span></span>
<span class="line"><span style="color:#B392F0;">            }});</span></span>
<span class="line"><span style="color:#B392F0;">        }</span></span>
<span class="line"><span style="color:#B392F0;">    }</span></span>
<span class="line"><span style="color:#B392F0;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><h2 id="fileprovider-路径配置策略的理解" tabindex="-1">FileProvider 路径配置策略的理解 <a class="header-anchor" href="#fileprovider-路径配置策略的理解" aria-hidden="true">#</a></h2><p><a href="https://blog.csdn.net/u013553529/article/details/83900704" target="_blank" rel="noreferrer">https://blog.csdn.net/u013553529/article/details/83900704</a></p><p><a href="https://juejin.cn/post/6844903476892270605" target="_blank" rel="noreferrer">https://juejin.cn/post/6844903476892270605</a></p><h2 id="选择文件" tabindex="-1">选择文件 <a class="header-anchor" href="#选择文件" aria-hidden="true">#</a></h2><h3 id="h5-api获取图片路径" tabindex="-1">h5+ api获取图片路径 <a class="header-anchor" href="#h5-api获取图片路径" aria-hidden="true">#</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code-dark" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">// 从相册中选择图片</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;从相册中选择多张图片:&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">plus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">gallery</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">pick</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">i</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">files</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">files</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">i</span><span style="color:#ABB2BF;">]);</span></span>
<span class="line"><span style="color:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E5C07B;">console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;取消选择图片&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;">        { </span><span style="color:#E06C75;">filter</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;image&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">multiple</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#ABB2BF;">      );</span></span>
<span class="line"></span></code></pre><pre class="shiki min-dark vp-code-light" tabindex="0"><code><span class="line"><span style="color:#B392F0;"> </span><span style="color:#6B737C;">// 从相册中选择图片</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;从相册中选择多张图片:&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">      </span><span style="color:#79B8FF;">plus</span><span style="color:#B392F0;">.</span><span style="color:#79B8FF;">gallery</span><span style="color:#B392F0;">.pick(</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">function</span><span style="color:#B392F0;"> (e) {</span></span>
<span class="line"><span style="color:#B392F0;">          </span><span style="color:#F97583;">for</span><span style="color:#B392F0;"> (</span><span style="color:#F97583;">var</span><span style="color:#B392F0;"> i </span><span style="color:#F97583;">in</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">e</span><span style="color:#B392F0;">.files) {</span></span>
<span class="line"><span style="color:#B392F0;">            </span><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#79B8FF;">e</span><span style="color:#B392F0;">.files[i]);</span></span>
<span class="line"><span style="color:#B392F0;">          }</span></span>
<span class="line"><span style="color:#B392F0;">        }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        </span><span style="color:#F97583;">function</span><span style="color:#B392F0;"> (e) {</span></span>
<span class="line"><span style="color:#B392F0;">          </span><span style="color:#79B8FF;">console</span><span style="color:#B392F0;">.log(</span><span style="color:#FFAB70;">&quot;取消选择图片&quot;</span><span style="color:#B392F0;">);</span></span>
<span class="line"><span style="color:#B392F0;">        }</span><span style="color:#BBBBBB;">,</span></span>
<span class="line"><span style="color:#B392F0;">        { filter</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#FFAB70;">&quot;image&quot;</span><span style="color:#BBBBBB;">,</span><span style="color:#B392F0;"> multiple</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> </span><span style="color:#79B8FF;">true</span><span style="color:#B392F0;"> }</span></span>
<span class="line"><span style="color:#B392F0;">      );</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div>`,63),e=[o];function t(B,r,c,y,F,i){return n(),a("div",null,e)}const E=s(p,[["render",t]]);export{u as __pageData,E as default};
